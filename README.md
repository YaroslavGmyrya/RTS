# Отчет по практической работе №1

##  Темы

1. Мьютексы
2. Условные переменные
3. Ресурсный менеджер

### Разделяемые ресурсы

При многопоточной работе программы могут возникать ситуации, когда в один и тот же момент времени 2 потока хотят обратиться к одному ресурсу (например к памяти). После манипуляции обоих потоков с этим ресурсом нельзя гарантировать его целостность. Для таких случаев в языках программирования предусмотрены механизмы защиты разделяемых ресурсов.

#### Mutex
Один из способов синхронизировать работу потоков и защитить разделяемый ресурс - использовать mutex. Он гарантирует, что исполнять критическую секцию кода (где идет работа с разделяемым ресурсом) в определенный момент времени может только один поток. Это снижает производительность, но повышает безопасность. Принцип использования: необходимо обернуть критическую секцию кода в mutex, т.е в начале критической секции сделать lock_mutex, а в конце - unlock.

#####  Задание

Необходимо дополнить код программы мьютексами так, чтобы программа работала корректно. Выполненное задание в файле **nomutex.c**.

На скрине ниже функция, которая запущена в нескольких потоках. Сразу в нескольких потоках идет работа с переменными var1 и var2, что недопустимо, поэтому необходимо обернуть этот участок кода в мьютекс. После этого программа начинает работать корректно.
[![image.png](https://i.postimg.cc/zXdnh9jS/image.png)](https://postimg.cc/9r7R5gsr)

#### Conditional variable
Еще один способ синхронизировать работу потоков. При работе с сonditional variable потоки делятся на 2 типа: ожидающие и сигнализирующие. Ожидающий поток как бы "спит", а сигнализирующий с помощью специальных функций подает сигнал пробуждения, и спящий поток просыпается. Удобно использовать, когда необходимо синхронизировать потоки при выполнении какого-нибудь условия.
#####  Задание

Необходимо дополнить код программы потоками так, чтобы получился следующий конечный автомат:
[![image.png](https://i.postimg.cc/C5pzk4Z6/image.png)](https://postimg.cc/Hc3YCX9Q)

При этом необходимо синхронизировать работу потоков с помощью conditional variables. 
Выполненное задание в файле **condvar.c**

Я дополнил код следующими потоками:
[![image.png](https://i.postimg.cc/gr9qwRdp/image.png)](https://postimg.cc/Pv489CPV)
[![image.png](https://i.postimg.cc/8kLb3KbT/image.png)](https://postimg.cc/ThYm5cSs)

Здесь функция pthread_cond_wait погружает в сон поток до тех пор, пока не придет сигнал от другого потока, который посылается с помощью pthread_cond_broadcast. Эта функция будит сразу все потоки, но в каждый момент времени будет работать только один поток благодаря условиями со state, и между ними будет корректный переход.

####  Ресурсный менеджер

Ресурсный менеджер - это система,  которая отвечает за распределение, учёт и контроль использования ограниченных ресурсов.

#####  Задание
Имеется сам ресурсный менеджер и клиенты, которые могут к нему подключаться. Клиенты могут писать и считывать данные с ресурсного менеджера. Задача заключается в том, чтобы сразу несколько клиентов могли получать доступ к данным ресурсного менеджера без рисков повредить данные. В данном задании общим ресурсом является переменная DEVICE_MEMMORY[], поэтому все операции с ней я обернул в мьютекс, чтобы в каждый момент времени только один клиент мог работать с этой переменной. Для проверки результата я добавил 2 вида клиентов: одни отправляют запросы на запись (запускать с флагом -w), другие - на чтение (запускать с флагом -r). Передача данных между программами осуществляется с помощью сокетов.
Выполненное задание в файлах **resmgr.c** и **resmgr_client.c**

[![image.png](https://i.postimg.cc/sXjw45t9/image.png)](https://postimg.cc/wtrX6Rx7)
